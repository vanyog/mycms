Модул за контрол на достъпа на потребители
==========================================

Изисква модул usermenu. Изобщо двата модула user и usermenu трябва винаги да се инсталират заедно.

В html кода на страница, до която трябва да имат достъп само регистрирани потребители, се въвежда:

<!--$$_USER[_xxx]_$$-->

Принцип на действие на главната функция user($a = '') на модула:

Ако в $_SESSION не се съхраняват валидно потребителско име и парола се показва форма за влизане и въведените с тази форма потребителско име и парола се съхраняват в $_SESSION, след което страницата се презарежда за нова проверка. Ако запазените в $_SESSION потребителско име и парола не са валидни, те се изтриват и се генерира Access denied. При показване на страницата на мястото на елемента <!--$$_USER[_xxx]_$$--> се показва потребителското име на потребителя и хипервръзка "Изход".

След успешно разпознаване на потребител, на глобалната променлива $can_visit се задава стойност, определяща правото на потребителя да види съдържанието на страницата. Дали потребителят има право да види съдържанието на текущата страница се определя на няколко нива:
текуща страница, конкретен потребител;
текуща страница, всеки потребител;
всяка страница, всеки потребител.
Първите две нива се определят от записи в таблица $tn_prefix.'permissions', а последното от запис в тяблица $tn_prefix.'options'. Наличието на запис за дадено ниво, изключва проверката за следващите нива.
Ако в таблица $tn_prefix.'permissions' има запис с `user_id` - номер на потребителя, `type`='visit' и `object` - номера на текущата страница, правото на потребителя се определя от стойността на полето `yes_no` на този запис.
Ако в таблица $tn_prefix.'permissions' има запис с `user_id`=0, `type`='visit' и `object` - номера на текущата страница, правото на потребителя се определя от стойността на полето `yes_no` на този запис.
Ако в таблица $tn_prefix.'options' има запис с `name`='user_can_visit' правото на потребителя се определя от стойността на полето `value` на този запис.
Ако на същата страница се използва и модул usermenu, правата получени от този модул, автоматично разрешават правото за преглеждане.

Модулът получава параметри за промяна на своето действие по два начина:

1. с незадължителния параметър ххх
     -----------------------------
Ако ххх е 'edit' - на мястото на елемента се показва форма за редактиране данните на потребителя.
Ако ххх е 'login' - на мястото на елемента се показва форма за влизане с име и парола. Задаването на този параметър вместо неговото пропускане има ефект, че страницата за влизане се генерира както всички останали страници с помощта на шаблони от базата данни. Ако не се зададе параметър login формата за влизане се показва в отделна, съвсем празна страница, която се генерира с /lib/build_page.php.
Ако ххх е 'enter' - ако няма влязъл потребител се показва хипервръзка "Вход". Използва се за поставяне върху общодостъпни страници за посочване страницата за влизане на регистрирани потребители.

2. с параметър user в адреса на страницата
     -------------------------------------
Ако user=logout се предизвиква излизане на потребителя.
Ако user=newreg се показва форма за създаване на нов потребител.
Ако user=enter се проверява дали има влязъл потребител и ако няма, се показва форма за влизане, след което страницата се презарежда.

Настройки в таблица $tn_prefix.'options'
----------------------------------------
user_loginpage - Страница, на която се отива след влизане на потребителя.
user_logoutpage - Страница, на която се отива след излизане на потребителя.
user_mysqlpass = yes - задава за кодиране на паролите да се използва функцията password() на MySQS вместо php функцията sha1().
user_table - име на таблица с данни за потребителите без префикса $tn_prefix
user_types - Отделени със запетая имена на алтернативни функции за проверка на потребителското име и паролата.

Алтернативни функции за проверка на потребителското име и паролата
------------------------------------------------------------------
Използват се ако в таблица $tn_prefiz.'options' е зададена настройка с име 'user_types' и стойност - списък от разделени със запетаи имана.
Тези функции трябва да се намират във файлове с имена f_име.php, в директория $mod_pth и имената им да съвпадат с името на .php файловете без представката f_. Същите имена се добавят в списъка представен със стойността на настройката 'user_types'.
Всяка такава функция трябва да проверява по някакъв друг начин валидността на потребителското име и паролата (например, чрез справка с друга база данни) и при условие, че не са валидни - да върне false, но ако са валидни:
1. да ги прибави в таблица user_table, 
2. да установи променливи $_SESSION['user_username'], $_SESSION['user_password'] и $_SESSION['user_password_raw'], и 
3. да върне номера на новия въведен в таблица user_table запис.

Таблица с данни за потребителите
--------------------------------
Модулът по подразбиране използва таблица $tn_prefix.'users', но с настройката 'user_table' от таблица $tn_prefix.'options' може да се зададе и друго име  на тази таблица (Задава се без представката!). При зареждане на модула това име се прочита в глобалната променлива $user_table.

Полета на таблица $tn_prefix.$user_table
----------------------------------------
ID - номер на записа
type - кратък стринг, определящ типа на потребителя
date_time_0 - дата и час на създаване на записа
date_time_1 - дата и час на последно актуализиране на записа
date_time_2 - дата и час на последно влизане на потребителя
username - потребителско име
password - парола
email - имейл
firstname - първо име
secondname - второ име
thirdname - трето име
telephone - телефон
IP - IP адрес от който последно е влязъл потребителя

