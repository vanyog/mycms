Модул за качване на файлове
===========================

Модулът служи за качване на файлове, които да се показват като изображения или хипервръзки за отваряне или сваляне в страниците на сайта.

За да се използва този модул, в html кода на страницата се вмъква:

<!--$$_UPLOADFILE_XX[,nn,tt,ss,img,show-t-s]_$$-->

Където:
Квадратните скоби [] означават, че заграденото с тях не е задължително, но скобите не са част от елемента <!--$$_ _$$--> и не трябва да се слагат при писането му.
XX е задължителен параметър и представлява уникално за дадената страница име, с което се идентифицира файла. (Внимавайте да не сложите име img, защото това ще се сбърка с последната опция).
nn е незадължителен втори параметър, който се отделя от името със запетая и представлява номер на страница, на която се показва файла. Ако файлът се показва само на текущата страница, не е необходим, но ако същия файл ще се показва и на други страници, трябва да се посочи този номер, за да може единствен файл да се използва за всички страници.
tt - незадължителен трети параметър, който определя какво да се показва ако няма качен файл:
3 - ако времето за показване на файла е изтекло, се показва надпис "стар файл"
2 - да се показва надпис "Няма качен файл"
1 - да се показва текст без хипервръзката и
0 - да не се показва нищо.
ss - стриг, който започва задължително със 'style="' и завършва с " (двойна кавичка). Съдържа CSS дефиниции за форматиране на <a> или <img> елемента за показване на файла.
img - ако се добави тази опция пред хипервръзките към файлове от отпределени типове (doc, pdf) да се показват, съответни на типовете им картинки. Картинките трябва да се намират в поддиректория images на модула, имената им трябва да съвпадат с резширенията на файловете и трябва да са от тип png.
show-t-s - може да бъде и само show-t или show-s. Задава, показване след хипервръзката към файла на времето на качване (когато има -t) и/или размера на файла (когато има -s).

В нормален режим, на мястото на горния елемент се показва хипервръзка към качения файл, или изображение, ако файлът е изображение. Ако още не е качен файл се показва надпис, както е зададено с опция tt, или ако не е зададена опция tt - надпис "Няма качен файл" или не се показва нищо ако опция uploadfile_nofilenotext е 'true'.

В режим на редактиране, след надписа на връзката файла се показват знаци + и -, които служат съответно за качване или премахване на файла.

При качване с помощта но този модул на изображение с формат webp, понеже форматът не се поддържа от всички браузъри, за постигане на съвместимост, трябва в директорията за съхраняване на файлове на модула, по друг начин, например с FTP клиент, да се качат и .jp2, и .jpg файлове със същото име. Модулът връща пътя до съответния файл според браузъра на клиента. За Safari - jp2, за Internet Explorer - jpg.

Настройки, които се задават в таблица $tn_prefix.'options'
---------------------------------------------------------

uploadfile_dir - интернет директория, в която се съхраняват качваните файлове. Ако не се зададе се използва директорията на модула. (Трябва да завършва на / )

uploadfile_deletefileonly - ако има стойност 'true' се изтрива само файла от сървъра, а в записа му в базата данни - само полето `filename`. Така може да се направи, че надписът да продължава да се изписва на страницата, но без да е хипервръзка. Ако стойността не е 'true', се изтрива както файла от сървъра, така и записът му от таблица $tn_prefix.'files' и на мястото на хипервръзката се изписва "Няма качен файл" или нищо, ако опцията uploadfile_nofilenotext е 'true'.

uploadfile_nofilenotext - ако има стойност 'true', когато няма качен файл в страниците не се показва никакъв надпис, освен в режим на редактиране. Тази опция се отменя локално чрез третия параметър tt, изпращан на функцията на модула.

uploadfile_otherroot - използва се, когато сайтът се премества на друг сървър. Тогава в базата данни ще стоят пътищата до тях от стария сървър и за да бъдат намерени на новия сървър се задава тази настройка. Тя съдържа пътя до директорията $_SERVER['DOCUMENT_ROOT'] на стария сървър. Ако пътищата до файловете в базата данни започват с този стринг, той автоматично се заменя с $_SERVER['DOCUMENT_ROOT'] на новия сървър и така се получават правилните пътища до файловете на новия сървър.



