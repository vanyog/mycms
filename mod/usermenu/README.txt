Потребителско меню
==================

Този модул изисква модул USER. Изобщо двата модула user и usermenu трябва винаги да се инсталират заедно.

На мястото на елемента:

<!--$$_USERMENU_[xxxx_]$$-->

се показва меню, с действия, които, влязъл в сайта потребител има право да извършва.

Когато сайтът се разлежда от администратора с пълни права, първият линк в менюто е "Admin path", отварящ директорията за администриране.

Ако на сайта е обособена група от страници за административни цели, към които няма линк във видимата от всички посетители навигация, адресът на главната страница на тази група трябва да се посочи с настройка с име 'admin_page'. Тогава на второ място в менюто се показва линк "Admin page", отварящ тази страница.

Действия извършвани чрез модула са: редактиране на текст; създаване/изтриване, скриване/показване на страница; вмъкване в съдържанието на една страница, съдържанието на друга страница; редактиране на линк от меню.

Още действия се извършват чрез други модули. Всеки модул може да добавя линкове към потребителското меню чрез постевен в директорията на модула файл с име f_menu_items.php. В този файл се дефинира функция с име: имеНаМодул_menu_items(), която трябва да връща HTTML кова на линковете, които трябва да се добавят от модула.

Елементът <!--$$_USERMENU_$$--> трябва да се вмъква в най-долната част на html кода, преди </body>, а разположението му върху страниците се управлява с CSS. Някои действия по редактиране на съдържание може да се извършват и с интерфейсни елементи, показвани върху страницата, а не с команди от менюто.

Принцип на действие на модула
-----------------------------
Модулът дефинира следните глобални променливи:
$can_edit = false;    // Право на потребителя да редактира надписите по страницата 
$can_create = false;  // Право на потребителя да създава/изтрива страници в дадения раздел(подменю) на сайта
$can_manage = array();// Права за администриране на модули
$can_visit = true;    // Право на влязъл потребител да вижда съдържанието на страницата.

Незадължителният параметър xxxx може да e адрес на страница за излизане и тогава към менюто се добавя линк "Изход". Ако на същата страница се използва <!--$$_USER_$$-->, този параметър не е необходим, защото тогава линк "Изход" се показва от него.

Ако на същата страница има и <!--$$_USER_$$--> елемент, той трябва да е разположен след <!--$$_USERMENU_$$-->. В противен случай страницата ще трябва да се презареди, за да се появи менюто върху нея.

Модулът създава и използва таблица $tn_prefix.'permissions', която съхранява информация за правата на регистрираните потребители, данните за които са в таблица с име, посочено в настройката 'user_table'. (По подразбиране - $tn_prefix.'users')

Структура на таблица $tn_prefix.'permissions'
--------------------------------------------
ID - номер на правото, primary, auto increment.
user_id - номер на потребител.
type - вид на правото. Това поле е от тип enum.
object - в зависимост от вида на правото това може да е: номер на страница, номер на меню, име на модул и др.
yes_no - 1 или 0 в зависимост от това дали се дава или се отнема съответното право.

Видовете права са:
------------------
all - всички права, дават се на администратори на сайта
visit - право да посети дадена страница.
page - право да редактира надписите от страницата;
menu - право да създава, изтрива и редактира страници, ползващи едно и също меню (подраздел от сайта);
records - право да променя само определени записи от някоя таблица на базата данни;
module - право да администрира модул;
bycode - право за редактиране на запис от таблица content, когато $_GET['code']=user_id, pregmatch(object,$_GET['i']).

Когато се задава право от тип record, поле object съдържа имеНаТаблица.имеНаПоле:xx1,xx2,..., и потребителят получава права върху записите, които имат стойности xx1, xx2, и т.н. на полето имеНаПоле от таблица имеНаТаблица. 

Приоритетите на правата са следните:
------------------------------------
(По-скоро това са идеи, които се имат предвид, но осъществяването им може да се отклонява малко от написаното.)

1. При наличие на право създаване/изтриване на страници в даден раздел, това право се отнася и за подразделите в същия раздел и дава право за редактиране на надписи и за управление на модули, освен когато тези права изрично не са отнети.

2. Изрично дадено право за редактиране на надписи на определени страници дава и право за управление на модули, освен ако второто не е изрично отнето.

3. Ако се дава само право за управление на модул трябва да се даде и право за посещение на страницата (`type`='visit'), в която е модула, освен ако това право не е дадено за всички регистрирани потребители (`user_id`=0).

4. Правото за променяне на избрани записи от таблица на базата данни се използва в отделни модули, които изискват такава функционалност.

5. Правото за виждане съдържанието на страница се дава автоматично щом бъде дадено и каквото и да е друго право.

Настройки в таблица $tn_prefix.'options'
----------------------------------------
usermenu_helppage - линк към страница за помощ на потребителите. Ако е зададена, в края на менюто за администриране, което се създава от модула, се показва линк Help към тази страница.
