ИНСТРУКЦИИ ЗА РАБОТА СЪС СИСТЕМАТА
----------------------------------

ИНСТАЛИРАНЕ

Ако ще се ползва и локално копие на сайта, на което да се изпробват новите страници, описаните по долу действия се извършват първо на локален сървър, а после се повтарят и на отдалечения сървър.

1. Ако се инсталира на съществуващ сайт се създава нова директория и в нея се копират файловете на системата. Ако се инсталира на нов сайт файловете на системата може да се сложат в главната директория, предназначена за страници на сайта. (За по-лесно надграждане, на локалния сървър може да се използва копие на системата от Git хранилището й.)

2. Ако е необходимо, се създава нова MySQL база данни и потребител за нея. Иначе може да се използва вече съществуваща. 

3. Изпълнява се скрипта manage/_install.php. Този скрипт пита за данните за достъп до базата данни, създава конфигурационен файл и продължава със създаване на основните таблици в базата данни.

4. Изпълнява се скрипта _secure.php от директория manage. Той генерира случайни стойности на някои данни с цел повишаване сигурността на сайта. Генерира, също така и ново име за директория manage.

5. Преименува се директория manage с новото име предложено от скрипта _secure.php. 

6. Директорията с ново име се защитава с парола.

7. В таблица options се задават правилни стойности на зеписите с имена:
host_web - домейн на сайта, 
host_local - локален домейн, по подразбиране е localhost, но на някои системи може да е друг
phpmyadmin_web - адрес на phpMyAdmin или друг панел за управление на базата данни на отдалечения сървър
phpmyadmin_local - адрес на phpMyAdmin или друг панел за управление на базата данни на локалния сървър.

8. Ако страниците от сайта ще се показват с кодова таблица, различна от Windows-1251 \cp1251\, във файл conf_database.php се задава стойност на променлива $colation. Например: $colation = 'utf8'; за използване на кодова теблица UTF-8.

ИНСТАЛИРАНЕ НА МОДУЛИ

По подразбиране, при инсталиране на системата се инсталират само 2 модула: user и usermenu. 

Повечето модули са описани в собствени README.txt файлове, които се намират в техните директории, а ако няма такива файлове, предназначението на модулите е описано в първите редове коментар на файла с главната функция на модула f_*.php. (Символа * замества името на модула.) Добра идея е запознаването с тази информация преди да се прави опит за ползване на който и да било модул.

Ако даден модул използва собствени таблици с данни или записи в главните таблици на системата, то преди използване на модула, той трябва да се инсталира, за да създаде тези таблици и записи. Инсталирането се извършва с _install.php с параметър m=ИмеНаМодул.

ИЗПОЛЗВАНЕ НА СИСТЕМАТА

Собственикът/администраторът на сайта, за да може да го редактира, трябва да посети директорията за администриране. Името на директорията е зададено при преименуването на директорията manage. В тази директория, ако са спазени горните указания, се влиза със зададените потребителско име и парола. След влизане се показва меню за администриране:

x.x.x.x, Home, /, Edit/Norm *, New page, < [ ] >, 1, all, File system, Database, cPanel, phpMyAdmin, $_SERVER, go to LOCAL/WEB, custome_link, w3c, mob, sp х

След първото влизане в директорията за администриране, това меню остава да се вижда на всяка страница на сайта. Позицията му е фиксирана - в горния край на прозореца на браузъра.

x.x.x.x e IP адресът на компютъра от който се посещава сайта. Показва се като хипервръзка, която отваря index.php файла от директорията за администриране.

Хипервръзката Home отваря главната страница на системата, а / - главната страница на сайта. В случай, че системата е инсталирана в главната директория на сайта, двете хипервръзки съвпадат и / не се показва.

Всяка, показвана от системата страница, се вижда в нормален режим (така както я виждат посетителите) или в режим на редактиране. Превключването между режимите става съответно с връзките Edit/Normal. (В нормален режим хипервръзката се вижда като Edit, а в режим на редактиране - като Norm *. Символът * е отделна хипервръзка, която отваря за редактиране текста на текущата страница.)

В режим на редактиране след някои надписи се показва хипервръзка *. Щракването върху тази хипервръзка отваря страница за редактиране на записа от базата данни, в който се съхранява този надпис.

Например, за да промените текста на автоматично създадената главна страница, щракнете върху Еdit и после върху връзката * след "Текст на страницата.". Така се отваря страница за редактиране на записа от таблица $tn_prefix.'content', който съдържа този надпис. Щракването на бутона "Save & Close" записва промените и връща към страницата, съдържаща текста.

За да промените заглавието "Начална страница", щракнете върху връзката * след заглавието.

Нова страница се създава с щракване върху New page. С това само се създава нов запис в таблица 'pages' и се отваря страница за редактиране на този запис. Новосъздадената страница после се отваря в режим на редактиране с щракване върху препратката с номер в менюто за администриране. По-мощна функция за създаване на нови страници се предоставя от модула usermenu. (Вижте файл mod/usermenu/README.txt.)

Хипервръзките със знаци < и > отварят съответно страницата със следващия по-малък или по-голям номер, от номера на текущата страница.

Полето за редактиране между двата знака < и > служи за отваряне на страницата с номер, написаното в това поле число. Щом напишете число в това поле трябва да натиснете Enter, за да се зареди страницата с този номер. Ако при натискането на клавиш Enter е задържан натиснат и клавиш Ctrl, страницата с написания номер се отваря в нов подпрозорец на браузъра.

Хипервръзката с надпис число отваря в режим на редактиране последната добавена на сайта страница. (Числото е номера на тази страница.)

Хипервръзката R отваря случайно избрана страница от сайта.

all - отваря страница, показваща таблица с номерата на съществуващите на сайта страници. Всеки номер е хипервръзка, която отваря съответната страница.

File System отваря страница, която показва списък на файловете от директорията, в която се намира системата, и дава някои възможности да бъдат редактирани директно тези файлове.

Database отваря страница, която показва списък на таблиците от базата данни, които принадлежат на системата (имената им започват със зададената със стойността на променливата $tn_prefix представка) и дава възможност за добавяне, изтриване и редактиране на записи в тези таблици.

cPanel отваря панела за администриране на сайта. В настройката cpanel_url трябва да е зададен неговия адрес.

phpMyAdmin отваря phpMyAdmin панела за управление на базата данни. Неговият адрес трябва да е зададен в настройката phpmyadmin_web - за отдалечения сървър и в phpmyadmin_local - за локалния сървър.

$_SERVER отваря страница, показваща елементите на този масив и резултатът от функция phpinfo().

go to LOCAL или go to WEB отваря същата страница на локалния сървър, когато сте на отдалечения сървър, или обратно.

w3c (не се показва на локален сървър) отваря html валидатора https://validator.w3.org за проверка на html кода на страницата.

mob (не се показва на локален сървър) отваря https://search.google.com/test/mobile-friendly с цел проверка пригодността на страницата за мобилни устройства.

sp (не се показва на локален сървър) отваря https://developers.google.com/speed/pagespeed/insights с цел измерване бързината на сайта.

adm_links_custom e настройка, която съдържа допълнителен html код, който се добавя в края на менюто за администриране по желание на разработчика на сайта.

Знакът х в края на менюто, скрива менюто за администриране. За да се покаже отново, трябва да се посети директорията за администриране.

ИЗПОЛЗВАНЕ НА CKEditor

Към всяко поле за редактиране на многоредови текстове, е добавен бутон "CKEditor", щракването на който предизвиква зареждане на редактора върху полето за редактиране. Веднъж зареден редакторът не се премахва и ако Ви се наложи да редактирате html код трябва да използвате бутона "Изходен код" ("Source code") на CKEditor.

Ако все пак, искате да премахнете редактора, трябва да презаредите страницата за редактиране, като преди това, ако прецените че трябва, запазите промените.

ВНИМАНИЕ: Не използвайте CKEditor за текстове, които трябва да не съдържат html тагове, нито пък при редактиране на файлове!

По подразбиране се използва отдалечената версия на CKEditor от адрес: cdn.ckeditor.com/4.5.7/standard/ckeditor.js. 

Използване на локално копие на CKEditor е необходимо при липса на връзка с Интернет или за постигане на по-голяма бързина. В такива случаи трябва да го изтеглите от неговия сайт http://ckeditor.com/download и съдържащата се в .zip файла директория ckeditor - да сложите в директорията, съдържаща файловете от директория manage.

Ако на сайта вече име инсталиран локално CKEditor, може да използвате него като в настройката 'ckeditor_file' напишете пълния път до неговия изпълним файл ckeditor.js.

РЕДАКТИРАНЕ НА ФАЙЛОВЕ

При щракване на хипервръзката File system се показва списък на файловете и директориите. Директориите са с получер шрифт. Щракването върху име на директория показва списък на файловете и директориите от нея. Щракването върху име на файл отваря файла за редактиране.

Срещу всеки файл има радиобутон, с който един от всички файлове, може да се избира. Файл се избира по този начин за да се извърши върху него едно от действията, за които има бутони:
- да се отвори в браузъра с бутон "View"
- да се преименува с бутон "Rename" или 
- да се изтрие с бутон "Delete".

За да се изпълни php файл, се щраква радиобутона пред името му и после бутона "View". Ако за изпълнение на файла са необходими параметри, те се пишат в полето, означено с ?, под таблицата с имената на файловете, преди щракване на бутона "View".

Нов файл се създава с бутон "Create file".

Нова директория се създава с бутон "MkDir".

Директория може да се изтрие с бутон "Delete" само ако е празна. Бутон "Delete" на отдалечен сървър не изтрива файлове, освен ако не е зададена настройка can_delete_files със стойност 'true'.

РЕДАКТИРАНЕ НА ЗАПИСИ В ТАБЛИЦИТЕ НА БАЗАТА ДАННИ

Щракването върху хипервръзката "Database" отваря страница, в която се показват имената на таблиците в базата данни, а срещу всяко име на таблица - списък на имената на полетата от съответната таблица.

Щракването върху името на таблица отваря страница, която показва последните няколко записиса от таблицата.

Броят на показваните записи може да се промени с промяна на стойността в полети между демите records viewd и се щракне бутона Change.

По подразбиране редът на показване е обратен на номерата на записите - най-новият запис е първи. Подреждането на записите се променя с щракване върху името на полето, по което искаме подреждане. Първото щракване задава ред на нарастване, второто - ред на намаляване и т.н.

За да се редактира запис се щраква върху номера му в колона ID на таблицата.

За да се изтрие запис се щраква бутона "х" до номера му в колона ID на таблицата.

За създаване на нов запис се щраква бутона "New record" под таблицата.

За намиране на определен запис, от падащия списък се избира име на поле, а в полето след LIKE се пише стойността, която трябва да има това поле. Може да се задава и частично съвпадение със символ % отпред, отзад или от двете страни на стойността, която се търси. Щракването на бутона "Filter" ще изведе в таблицата само записите, за които има съвпадение по избраното поле. Ако не бъдат немерени съвпадения, се извеждат последните, добавени в таблицата записи.

ЕЗИЦИ

Езиците, на които се показват текстове на сайта, се задават с настройката languages, която се съхранява в таблица $tn_prefix.'options'. Тази настройка представлява PHP скрипт, присвояващ стойност на променливата $languages. Тази променлива е асоциативен масив с ключове - кодовете на езиците и стойности - иманата им. Например, за сайт на български и английски: $languages = array('bg' => 'Български', 'en' => 'English');.

Знаменца за смяна на езика се показват на място, на което е вмъкнат елемент <!--$$_LANGUAGEFLAGS_$$-->.

Върху начина на показване на знеменцата влияе настройката 'flag_setting'.
При стойност 'flag&text' се показва знаме и име на езика под него;
при стойност 'flag text' се показва знаме и име на езика до него;
при стойност 'flag' се показва само знаме, което е така по подразбиране;
а при 'text' се показва само текстова хипервръзка.

Езикът по подразбиране на сайта се задава в настройката 'default_language', чиято стойност е кода на езика по подразбиране. Ролята на езика по подразбиране е тази, че когато функция translate() не намери превод на даден стринг на текущия език, тя търси този стринг на езика по подразбиране. Желателно е всеки надпис на сайта да има превод на езика по подразбиране, защото при липса на превод на текущия език, вместо смислен текст ще се покаже само името на надписа, което не би направило добро впечатление на никой посетител.

АКТУАЛИЗИРАНЕ ДО ПО-НОВА ВЕРСИЯ

Препоръчително е актуализирането до по-нова версия да се извършва на локален сървър и след като се установи, че всичко работи без проблеми, може да се пристъпи към актуализиране и на отдалечения сървър с работещия сайт. Стъпките, които ще изредим се отнасят за поддържане на системата с помощта на команден Git клиент.

1. (Първите две стъпки са необходими само ако са правени промени директно в php файловете на отдалечения сървър. Ако не са правени такива промени, може да се премине направо към стъпка 4.) С помощта на FTP клиент с опция за заменяне на всички различаващи се по размер файлове и бинарен режим се свалят всички файлове от отдалечения на локалния сървър.

2. Сваля се от отдалечения сървър и се актуализира на локалния сървър цялата база данни.

3. Свалянето на файлове от отдалечения сървър предизвика промени, които трябва да се отменят с 'git checkout .'.

4. Изпълнява се команда 'git pull' за да се свалят от GitHub файловете на най-нова версия на системата.

5. Проверява се файл UPGRADE.txt за необходимост от ръчни промени в структурата на таблиците от базата данни и се правят такива. Същите се правят и на отдалечения сървър.

6. Проверява се функционирането на сайта на локалния сървър и при установяване на проблеми се отстраняват.

7. Файловете от локалния сървър се качват на отдалечения. Внимава се да не се качат директориите .git и manage. Вместо да се качва директория manage се качват само файловете от нея в преименуваната, защитена с парола директория, която изпълнява нейната функция на отдалечения сървър.

